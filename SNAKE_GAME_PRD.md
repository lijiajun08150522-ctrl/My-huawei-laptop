# 贪吃蛇游戏 - 产品需求文档 (PRD)

## 1. 项目概述

### 1.1 项目目标
开发一款经典贪吃蛇游戏，提供流畅的游戏体验、逐渐增加的难度挑战，以及清晰的得分反馈机制。

### 1.2 目标用户
- 休闲游戏玩家
- 寻找简单娱乐的用户
- 想要放松和打发时间的用户

### 1.3 技术栈
- **实现方式**：HTML5 + JavaScript（Web版）或 Python（CLI版）
- **优先推荐**：HTML5 + JavaScript（更好的视觉效果和跨平台兼容性）

---

## 2. 核心功能

### 2.1 游戏机制

#### 2.1.1 蛇的移动
- **基本规则**：蛇在游戏区域内持续移动
- **移动方向**：上、下、左、右四个方向
- **移动控制**：通过键盘方向键控制（↑↓←→ 或 WASD）
- **移动速度**：初始速度为每200ms移动一格

#### 2.1.2 碰撞检测
- **撞墙死亡**：蛇头碰到游戏区域边界，游戏结束
- **撞自己死亡**：蛇头碰到蛇身，游戏结束

### 2.2 食物系统

#### 2.2.1 食物生成
- **随机位置**：食物随机出现在游戏区域内
- **不重叠**：食物不会出现在蛇身位置
- **单个食物**：同一时间屏幕上只有一个食物

#### 2.2.2 吃食物
- **增长机制**：吃到食物后，蛇身长度+1
- **得分增加**：吃到食物获得10分
- **新食物**：食物被吃掉后，立即生成新食物

---

## 3. 得分机制

### 3.1 基础得分
- **每次吃食物**：+10分

### 3.2 奖励机制
- **连续得分**：无额外奖励（保持简单）
- **关卡奖励**：每个关卡完成时额外+50分

### 3.3 得分显示
- **实时显示**：游戏界面顶部显示当前得分
- **最高分**：显示历史最高分（使用localStorage持久化）
- **关卡显示**：显示当前关卡数

### 3.4 得分示例

| 动作 | 得分 | 说明 |
|------|------|------|
| 吃第1个食物 | +10 | 基础得分 |
| 吃第2个食物 | +10 | 基础得分 |
| ... | ... | ... |
| 吃第5个食物（升到2级） | +10 + 50 | 基础+关卡奖励 |
| 吃第10个食物（升到3级） | +10 + 50 | 基础+关卡奖励 |

---

## 4. 关卡与速度系统

### 4.1 关卡升级机制

#### 4.1.1 升级条件
- **食物数量**：每吃掉5个食物升一级
- **自动升级**：满足条件后自动升级

#### 4.1.2 关卡范围
- **最低关卡**：Level 1
- **最高关卡**：Level 10（速度达到最快后不再升级）

### 4.2 速度递增机制

#### 4.2.1 速度计算公式
```
Level 1: 200ms/格 (初始速度)
Level 2: 180ms/格
Level 3: 160ms/格
Level 4: 140ms/格
Level 5: 120ms/格
Level 6: 100ms/格
Level 7: 90ms/格
Level 8: 80ms/格
Level 9: 70ms/格
Level 10: 60ms/格 (最快速度)
```

#### 4.2.2 速度递减规律
- **递减量**：每级速度减少20ms
- **Level 6后**：每级速度减少10ms
- **公式**：
  - Level 1-5: `speed = 200 - (level - 1) * 20`
  - Level 6-10: `speed = 120 - (level - 5) * 10`

### 4.3 关卡显示
- **游戏界面**：显示当前关卡
- **升级提示**：升级时显示"升级到 Level X!"的提示
- **速度提示**：升级时显示"速度提升!"的提示

---

## 5. 控制系统

### 5.1 键盘控制

#### 5.1.1 方向键控制
| 按键 | 功能 |
|------|------|
| ↑ / W | 向上移动 |
| ↓ / S | 向下移动 |
| ← / A | 向左移动 |
| → / D | 向右移动 |

#### 5.1.2 游戏控制键
| 按键 | 功能 |
|------|------|
| 空格键 | 开始/暂停游戏 |
| Enter键 | 游戏结束后重新开始 |
| P键 | 暂停/继续游戏 |

### 5.2 控制规则

#### 5.2.1 防止掉头
- **禁止直接反向**：蛇不能直接掉头（如向上时不能直接按下）
- **忽略无效输入**：忽略会导致蛇反向的按键

#### 5.2.2 快速输入处理
- **缓冲队列**：支持快速按键，按键进入队列等待执行
- **每帧执行一个**：每次移动只执行队列中的一个方向变化
- **队列长度限制**：最多缓冲3个方向变化（防止输入过快导致逻辑错误）

### 5.3 触摸控制（移动端）
- **滑动方向**：支持上下左右滑动控制
- **点击暂停**：点击屏幕中央暂停/继续

---

## 6. 游戏界面

### 6.1 布局设计

```
┌─────────────────────────────────┐
│   🐍 贪吃蛇游戏   [最高分: 100]  │  <- 顶部栏
│  ┌───────────────────────────┐   │
│  │                           │   │
│  │      游戏区域              │   │
│  │                           │   │
│  └───────────────────────────┘   │
│                                 │
│  得分: 30  关卡: 1  速度: 200ms  │  <- 状态栏
│  [空格: 暂停]  [R: 重新开始]    │  <- 提示栏
└─────────────────────────────────┘
```

### 6.2 视觉元素

#### 6.2.1 颜色方案
- **蛇头**：深绿色 (#2E7D32)
- **蛇身**：浅绿色 (#4CAF50)
- **食物**：红色 (#F44336)
- **背景**：深灰色 (#1E1E1E)
- **网格线**：浅灰色 (#333333)

#### 6.2.2 动画效果
- **平滑移动**：蛇的移动使用CSS过渡（可选）
- **食物闪烁**：食物闪烁效果吸引注意力
- **升级提示**：升级时显示弹窗或闪烁效果
- **死亡效果**：游戏结束时蛇身闪烁

### 6.3 响应式设计
- **桌面端**：固定大小 600x400px
- **移动端**：自适应屏幕宽度
- **保持比例**：3:2 宽高比

---

## 7. 游戏流程

### 7.1 游戏开始流程

```
1. 用户打开游戏页面
   ↓
2. 显示欢迎界面和"按空格键开始"
   ↓
3. 用户按空格键
   ↓
4. 游戏开始，蛇开始移动
   ↓
5. 用户通过键盘控制方向
   ↓
6. 吃食物得分，蛇身增长
   ↓
7. 每吃5个食物升级，速度加快
   ↓
8. 直到游戏结束
```

### 7.2 游戏结束流程

```
1. 发生碰撞（撞墙或撞自己）
   ↓
2. 游戏暂停
   ↓
3. 显示游戏结束弹窗
   ↓
4. 显示最终得分
   ↓
5. 如果打破最高分，显示"新纪录！"
   ↓
6. 提示"按R键重新开始"
   ↓
7. 用户按R键
   ↓
8. 游戏重置，重新开始
```

### 7.3 暂停流程

```
1. 游戏进行中，用户按空格键/P键
   ↓
2. 游戏暂停
   ↓
3. 显示"暂停"提示
   ↓
4. 用户再次按空格键/P键
   ↓
5. 游戏继续
```

---

## 8. 数据持久化

### 8.1 最高分存储
- **存储方式**：使用浏览器 localStorage
- **存储键名**：`snakeGameHighScore`
- **存储内容**：整数类型的最高分
- **初始值**：0

### 8.2 存储时机
- **游戏开始时**：读取最高分
- **游戏结束时**：如果当前分 > 最高分，更新最高分

---

## 9. 非功能需求

### 9.1 性能要求
- **帧率**：60 FPS
- **响应时间**：按键延迟 < 16ms
- **流畅度**：移动无卡顿

### 9.2 兼容性
- **浏览器**：Chrome, Firefox, Safari, Edge 最新版本
- **分辨率**：支持 1024x768 及以上分辨率
- **移动端**：支持 iOS 和 Android 浏览器

### 9.3 可用性
- **学习成本**：3分钟内掌握基本操作
- **操作反馈**：所有操作都有视觉反馈
- **错误提示**：游戏结束有明确提示

---

## 10. 开发计划

### 10.1 开发阶段

| 阶段 | 内容 | 预计时间 |
|------|------|----------|
| 1 | 基础游戏逻辑（蛇移动、食物、碰撞） | 2小时 |
| 2 | 得分系统和关卡系统 | 1小时 |
| 3 | 键盘控制和输入处理 | 1小时 |
| 4 | 界面美化和动画效果 | 1小时 |
| 5 | 数据持久化和响应式设计 | 0.5小时 |
| 6 | 测试和优化 | 0.5小时 |

**总计**：约 6 小时

### 10.2 技术实现要点

#### 核心数据结构
```javascript
// 游戏状态
gameState = {
    snake: [{x, y}, {x, y}, ...],  // 蛇身坐标数组
    direction: {x, y},              // 当前移动方向
    food: {x, y},                   // 食物坐标
    score: 0,                       // 当前得分
    level: 1,                       // 当前关卡
    speed: 200,                     // 移动速度(ms)
    isRunning: false,               // 游戏是否运行
    isPaused: false,                // 游戏是否暂停
    highScore: 0                    // 最高分
}
```

#### 游戏循环
```javascript
function gameLoop() {
    if (!isRunning || isPaused) return;

    moveSnake();           // 移动蛇
    checkCollision();       // 检测碰撞
    checkFood();            // 检测是否吃到食物
    draw();                 // 绘制界面

    setTimeout(gameLoop, gameState.speed);  // 循环调用
}
```

---

## 11. 测试用例

### 11.1 功能测试
- [ ] 蛇能正确向四个方向移动
- [ ] 蛇不能直接掉头
- [ ] 吃到食物后蛇身增长
- [ ] 吃到食物后得分+10
- [ ] 吃到5个食物后升级
- [ ] 升级后速度加快
- [ ] 撞墙后游戏结束
- [ ] 撞到自己后游戏结束
- [ ] 按空格键可以暂停
- [ ] 按R键可以重新开始

### 11.2 边界测试
- [ ] 在最高关卡速度正确
- [ ] 最高分正确保存和读取
- [ ] 快速按键不会导致逻辑错误
- [ ] 移动端触摸控制正常工作

---

## 12. 附录

### 12.1 参考资源
- Canvas API 文档
- Game Loop 设计模式
- 键盘事件处理最佳实践

### 12.2 版本历史
- v1.0 - 初始版本（本文档）

---

## 13. 确认签字

- [ ] 产品经理
- [ ] 开发工程师
- [ ] 测试工程师

---

**文档版本**：v1.0
**创建日期**：2026-01-27
**最后更新**：2026-01-27
